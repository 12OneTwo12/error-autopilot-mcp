# Error Autopilot MCP (Kotlin)

Loki/Tempoì—ì„œ ì—ëŸ¬ë¥¼ ìë™ìœ¼ë¡œ ìˆ˜ì§‘í•˜ê³ , **GitHub APIë¥¼ í†µí•´ ì½”ë“œë¥¼ ë¶„ì„**í•œ í›„ GitHub ì´ìŠˆë¥¼ ìƒì„±í•˜ëŠ” Claude Code MCP ì„œë²„ì…ë‹ˆë‹¤.

**Kotlin ë²„ì „** - ê³µì‹ [Kotlin MCP SDK](https://github.com/modelcontextprotocol/kotlin-sdk) ì‚¬ìš©

## Features

- ğŸ” **Loki ì—ëŸ¬ ëª¨ë‹ˆí„°ë§**: ì‹¤ì‹œê°„ ì—ëŸ¬ ë¡œê·¸ ìˆ˜ì§‘ ë° í•„í„°ë§
- ğŸ”— **Tempo ë¶„ì‚° íŠ¸ë ˆì´ì‹±**: trace_idë¡œ ì „ì²´ ìš”ì²­ íë¦„ ì¶”ì 
- ğŸ“ **GitHub ì´ìŠˆ ìë™ ìƒì„±**: ë¶„ì„ëœ ì—ëŸ¬ë¥¼ ì´ìŠˆë¡œ ë³€í™˜
- ğŸŒ **GitHub API ì½”ë“œ ë¶„ì„**: ë¡œì»¬ íŒŒì¼ ì—†ì´ ì›ê²© ì €ì¥ì†Œ ì½”ë“œ ë¶„ì„
- ğŸ“‹ **ì´ìŠˆ í…œí”Œë¦¿ ê´€ë¦¬**: GitHub ì´ìŠˆ í…œí”Œë¦¿ ê°€ì ¸ì˜¤ê¸° ë° ë Œë”ë§
- ğŸŒ **í™˜ê²½ ë¶„ë¦¬ (dev/prod)**: ê°œë°œ/ìš´ì˜ í™˜ê²½ ë³„ë„ ì¡°íšŒ ì§€ì›

## Quick Start

```bash
# 1. í´ë¡  ë° ë¹Œë“œ
git clone https://github.com/12OneTwo12/error-autopilot-mcp-kotlin.git
cd error-autopilot-mcp-kotlin
./gradlew build

# 2. Fat JAR ìƒì„±
./gradlew jar

# 3. ì—°ê²° í…ŒìŠ¤íŠ¸ (ì„ íƒ)
./gradlew testConnection

# 4. Claude Codeì— ë“±ë¡
```

## Claude Code ì„¤ì •

`~/.claude.json`ì— MCP ì„œë²„ ì¶”ê°€:

```json
{
  "mcpServers": {
    "error-autopilot": {
      "type": "stdio",
      "command": "java",
      "args": ["-jar", "/path/to/error-autopilot-mcp-kotlin/build/libs/error-autopilot-mcp-1.0.0.jar"],
      "env": {
        "LOKI_URL_DEV": "https://dev-loki.example.com",
        "TEMPO_URL_DEV": "https://dev-tempo.example.com",
        "LOKI_URL_PROD": "https://prod-loki.example.com",
        "TEMPO_URL_PROD": "https://prod-tempo.example.com"
      }
    }
  }
}
```

## í™˜ê²½ë³€ìˆ˜

ëª¨ë“  Loki/Tempo ë„êµ¬ëŠ” `env` íŒŒë¼ë¯¸í„°ë¥¼ ì§€ì›í•©ë‹ˆë‹¤ (dev/prod, ê¸°ë³¸: dev)

### ê°œë°œ í™˜ê²½ (DEV)
| ë³€ìˆ˜ | ì„¤ëª… | ê¸°ë³¸ê°’ |
|------|------|--------|
| `LOKI_URL_DEV` | ê°œë°œ Loki ì„œë²„ URL | http://localhost:3100 |
| `TEMPO_URL_DEV` | ê°œë°œ Tempo ì„œë²„ URL | http://localhost:3200 |

### ìš´ì˜ í™˜ê²½ (PROD)
| ë³€ìˆ˜ | ì„¤ëª… | ê¸°ë³¸ê°’ |
|------|------|--------|
| `LOKI_URL_PROD` | ìš´ì˜ Loki ì„œë²„ URL | http://localhost:3100 |
| `TEMPO_URL_PROD` | ìš´ì˜ Tempo ì„œë²„ URL | http://localhost:3200 |

### ê³µí†µ
| ë³€ìˆ˜ | ì„¤ëª… | ê¸°ë³¸ê°’ |
|------|------|--------|
| `LOKI_ORG_ID` | Loki ì¡°ì§ ID | default |
| `TEMPO_ORG_ID` | Tempo ì¡°ì§ ID | default |

## MCP ë„êµ¬

> **Note**: ëª¨ë“  Loki/Tempo ë„êµ¬ëŠ” `env` íŒŒë¼ë¯¸í„°ë¥¼ ì§€ì›í•©ë‹ˆë‹¤. `"dev"` (ê¸°ë³¸) ë˜ëŠ” `"prod"`ë¥¼ ì§€ì •í•˜ì„¸ìš”.

### Loki ë¡œê·¸ ë„êµ¬

| ë„êµ¬ | ì„¤ëª… |
|------|------|
| `fetch_errors` | Lokiì—ì„œ ì—ëŸ¬ ë¡œê·¸ ì¡°íšŒ (env, severity, service í•„í„°ë§) |
| `query_logs` | ì»¤ìŠ¤í…€ LogQL ì¿¼ë¦¬ ì‹¤í–‰ |
| `list_services` | ì‚¬ìš© ê°€ëŠ¥í•œ ì„œë¹„ìŠ¤ ëª©ë¡ ì¡°íšŒ |
| `list_labels` | Loki ë ˆì´ë¸” ëª©ë¡ ì¡°íšŒ |
| `get_error_summary` | ì—ëŸ¬ ìš”ì•½ (ì„œë¹„ìŠ¤ë³„/ì‹¬ê°ë„ë³„ í†µê³„) |
| `test_connection` | Loki ì—°ê²° í…ŒìŠ¤íŠ¸ |

### Tempo íŠ¸ë ˆì´ìŠ¤ ë„êµ¬

| ë„êµ¬ | ì„¤ëª… |
|------|------|
| `get_trace` | trace_idë¡œ ë¶„ì‚° íŠ¸ë ˆì´ìŠ¤ ì¡°íšŒ |
| `search_traces` | ì„œë¹„ìŠ¤, ì‹œê°„, ì§€ì†ì‹œê°„ìœ¼ë¡œ íŠ¸ë ˆì´ìŠ¤ ê²€ìƒ‰ |
| `test_tempo_connection` | Tempo ì—°ê²° í…ŒìŠ¤íŠ¸ |

### ì¿¼ë¦¬ ìµœì í™”

`fetch_errors`ëŠ” ë‹¤ìŒê³¼ ê°™ì€ ìµœì í™”ëœ LogQL ì¿¼ë¦¬ë¥¼ ìƒì„±í•©ë‹ˆë‹¤:
- `deployment_environment`: ì¸ë±ì‹±ëœ ë ˆì´ë¸”ë¡œ ë¹ ë¥¸ í™˜ê²½ í•„í„°ë§
- `level`: structured metadataë¡œ ì‹¬ê°ë„ í•„í„°ë§ (ëŒ€ì†Œë¬¸ì ëª¨ë‘ ë§¤ì¹­)

ì˜ˆì‹œ:
```logql
{deployment_environment="dev"} | level=~"error|ERROR|critical|CRITICAL"
```

### ì´ìŠˆ í…œí”Œë¦¿ ë„êµ¬

| ë„êµ¬ | ì„¤ëª… |
|------|------|
| `list_issue_templates` | ë“±ë¡ëœ ì´ìŠˆ í…œí”Œë¦¿ ëª©ë¡ ì¡°íšŒ |
| `get_issue_template` | íŠ¹ì • í…œí”Œë¦¿ ìƒì„¸ ì¡°íšŒ |
| `import_github_template` | GitHub ë¦¬í¬ì—ì„œ ì´ìŠˆ í…œí”Œë¦¿ ê°€ì ¸ì˜¤ê¸° |
| `set_default_template` | ê¸°ë³¸ í…œí”Œë¦¿ ì„¤ì • |
| `render_issue` | í…œí”Œë¦¿ê³¼ ë³€ìˆ˜ë¡œ ì´ìŠˆ ë‚´ìš© ìƒì„± |

## ë¹Œë“œ

```bash
# ê°œë°œ ë¹Œë“œ
./gradlew build

# Fat JAR ìƒì„± (ëª¨ë“  ì˜ì¡´ì„± í¬í•¨)
./gradlew jar

# í…ŒìŠ¤íŠ¸ ì‹¤í–‰
./gradlew test

# ì—°ê²° í…ŒìŠ¤íŠ¸ (ì‹¤ì œ ì„œë²„ í•„ìš”)
./gradlew testConnection

# ì‹¤í–‰
java -jar build/libs/error-autopilot-mcp-1.0.0.jar
```

## í”„ë¡œì íŠ¸ êµ¬ì¡°

```
error-autopilot-mcp-kotlin/
â”œâ”€â”€ src/main/kotlin/io/github/onetwo/errorautopilot/
â”‚   â”œâ”€â”€ Main.kt                    # MCP ì„œë²„ ì§„ì…ì 
â”‚   â”œâ”€â”€ TestConnection.kt          # ì—°ê²° í…ŒìŠ¤íŠ¸ ìŠ¤í¬ë¦½íŠ¸
â”‚   â”œâ”€â”€ adapter/
â”‚   â”‚   â”œâ”€â”€ LokiAdapter.kt         # Loki API í´ë¼ì´ì–¸íŠ¸
â”‚   â”‚   â””â”€â”€ TempoAdapter.kt        # Tempo API í´ë¼ì´ì–¸íŠ¸
â”‚   â”œâ”€â”€ formatter/
â”‚   â”‚   â””â”€â”€ Formatters.kt          # ì¶œë ¥ í¬ë§·í„° (ì—ëŸ¬, íŠ¸ë ˆì´ìŠ¤)
â”‚   â”œâ”€â”€ model/
â”‚   â”‚   â”œâ”€â”€ ConfigModels.kt        # ì„¤ì • ë°ì´í„° í´ë˜ìŠ¤
â”‚   â”‚   â”œâ”€â”€ ErrorModels.kt         # ì—ëŸ¬ ë°ì´í„° í´ë˜ìŠ¤
â”‚   â”‚   â”œâ”€â”€ LokiModels.kt          # Loki API ì‘ë‹µ ëª¨ë¸
â”‚   â”‚   â”œâ”€â”€ Severity.kt            # ì‹¬ê°ë„ enum
â”‚   â”‚   â”œâ”€â”€ TemplateModels.kt      # í…œí”Œë¦¿ ë°ì´í„° í´ë˜ìŠ¤
â”‚   â”‚   â””â”€â”€ TraceModels.kt         # íŠ¸ë ˆì´ìŠ¤ ë°ì´í„° í´ë˜ìŠ¤
â”‚   â”œâ”€â”€ template/
â”‚   â”‚   â””â”€â”€ TemplateManager.kt     # ì´ìŠˆ í…œí”Œë¦¿ ê´€ë¦¬
â”‚   â””â”€â”€ tool/
â”‚       â””â”€â”€ ToolRegistry.kt        # MCP ë„êµ¬ ë“±ë¡ ë° í•¸ë“¤ëŸ¬
â”œâ”€â”€ src/test/kotlin/               # ë‹¨ìœ„ í…ŒìŠ¤íŠ¸
â”œâ”€â”€ src/main/resources/
â”‚   â””â”€â”€ logback.xml                # ë¡œê¹… ì„¤ì •
â”œâ”€â”€ .claude/skills/
â”‚   â””â”€â”€ autopilot.md               # /autopilot ìŠ¤í‚¬ ì •ì˜
â”œâ”€â”€ build.gradle.kts
â””â”€â”€ settings.gradle.kts
```

## ì•„í‚¤í…ì²˜

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                     Claude Code                              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                      â”‚ MCP Protocol (STDIO)
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                   Main.kt (MCP Server)                       â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚ToolRegistry â”‚  â”‚ Formatters  â”‚  â”‚  TemplateManager    â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
          â”‚                â”‚                    â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   LokiAdapter    â”‚ â”‚ ì¶œë ¥ ë³€í™˜  â”‚    â”‚  í…œí”Œë¦¿ CRUD    â”‚
â”‚   TempoAdapter   â”‚ â”‚           â”‚    â”‚  GitHub Import  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚
    â”Œâ”€â”€â”€â”€â–¼â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚  Loki   â”‚  â”‚  Tempo  â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## License

MIT
